<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LGWORK • 企业入口</title>
<style>
  :root{--pri:#0a66c2;--bg:#f3f2ef;--fg:#091e42;--muted:#5e6c84;--card:#fff;--border:#e0e0e0}
  body{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin:12px 0}
  .btn{background:var(--pri);color:#fff;border:0;border-radius:10px;padding:10px 16px;cursor:pointer}
  input,textarea,select{width:100%;background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;font-family:inherit}
  .progress{height:6px;background:#e9eef5;border-radius:6px;overflow:hidden;margin:8px 0}
  .progress>i{display:block;height:100%;width:0;background:var(--pri);transition:width .4s ease}
  .mono{white-space:pre-wrap;font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>
<body>
<div class="wrap">
  <h2>企业入口</h2>

  <div class="card">
    <h3>上传或粘贴 JD</h3>
    <input type="file" id="file" accept=".pdf,.doc,.docx,.txt" />
    <div style="margin:8px 0">或</div>
    <textarea id="jdtext" rows="8" placeholder="在此粘贴 JD 原文…"></textarea>
    <div class="progress"><i id="p1"></i></div>
    <button class="btn" id="btnParse">分析JD</button>
    <div id="jdout" class="mono" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <h3>我先说需求，由 AI 生成 JD</h3>
    <textarea id="need" rows="8" placeholder="例如：我们在上海招一名临床项目经理，负责I-III期多中心试验…"></textarea>
    <div class="progress"><i id="p2"></i></div>
    <button class="btn" id="btnGen">生成JD</button>
    <div id="genout" class="mono" style="margin-top:10px"></div>
  </div>
</div>
<script>
const $=s=>document.querySelector(s)
function setProg(id,v){$(id).style.width=v+'%'}
function typewriter(el, text){ el.textContent=''; let i=0; (function t(){ el.textContent+=text.slice(i,i+2); i+=2; if(i<text.length) requestAnimationFrame(t) })() }

$('#btnParse').onclick = async ()=>{
  setProg('#p1',20)
  const fd=new FormData(); const f=$('#file').files[0]; if(f) fd.append('file', f); fd.append('text',$('#jdtext').value)
  const r=await fetch('/api/jd/parse',{method:'POST',body:fd}); const d=await r.json(); setProg('#p1',90)
  typewriter($('#jdout'), d.jd_summary||'')
  setTimeout(()=>setProg('#p1',100),300)
}

$('#btnGen').onclick = async ()=>{
  setProg('#p2',20)
  const r=await fetch('/api/jd/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({need:$('#need').value,lang:'zh'})});
  const d=await r.json(); setProg('#p2',90); typewriter($('#genout'), d.jd||''); setTimeout(()=>setProg('#p2',100),300)
}
</script>
</body>
</html>
