<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LGWORK • 企业入口（JD 生成 / JD 解析）</title>
<style>
  :root{--pri:#0a66c2;--bg:#f3f2ef;--fg:#091e42;--muted:#5e6c84;--card:#fff;--border:#e0e0e0}
  body{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}
  h2{margin:0 0 12px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px}
  .btn{background:var(--pri);color:#fff;border:0;border-radius:10px;padding:10px 16px;cursor:pointer}
  input,textarea,select{width:100%;background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;font-family:inherit}
  .progress{height:6px;background:#e9eef5;border-radius:999px;overflow:hidden;margin:10px 0}
  .progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--pri),#2b8be6);transition:width .45s ease}
  .pulse>i{animation:pulse 1.1s ease-in-out infinite}
  @keyframes pulse{0%{opacity:.45}50%{opacity:1}100%{opacity:.45}}
  .mono{white-space:pre-wrap;font-family:ui-monospace,Menlo,Consolas,monospace}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h2>企业入口</h2>
  <div class="grid">
    <!-- 左列：我先说需求 → 生成 JD -->
    <div class="card">
      <h3>我先说需求，由 AI 生成 JD</h3>
      <textarea id="need" rows="10" placeholder="例如：我们在上海招临床项目经理，负责I-III期多中心试验，肿瘤方向，5年以上经验…"></textarea>
      <div class="progress" id="progG"><i></i></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="btnGen">生成 JD</button>
        <span class="muted" id="gstatus">就绪</span>
      </div>
      <div id="genout" class="mono" style="margin-top:8px"></div>
    </div>

    <!-- 右列：上传/粘贴 JD → 解析结构化要点（便于内部协作/复核） -->
    <div class="card">
      <h3>上传/粘贴 JD，解析要点</h3>
      <input type="file" id="jdfile" accept=".pdf,.doc,.docx,.txt" />
      <div style="margin:8px 0">或：</div>
      <textarea id="jdtext" rows="10" placeholder="在此粘贴 JD 原文…"></textarea>
      <div class="progress" id="progP"><i></i></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="btnParse">解析 JD</button>
        <button class="btn" id="btnCopy">复制到剪贴板</button>
        <span class="muted" id="pstatus">就绪</span>
      </div>
      <div id="jdout" class="mono" style="margin-top:8px"></div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s)
function setProg(el,v){ el.querySelector('i').style.width=Math.max(0,Math.min(100,v))+'%' }
function pulse(el,on){ el.classList.toggle('pulse',!!on) }
function tw(el,text){ el.textContent=''; let i=0; (function t(){ el.textContent+=text.slice(i,i+2); i+=2; if(i<text.length) requestAnimationFrame(t) })() }

$('#btnGen').onclick=async()=>{
  pulse($('#progG'),true); setProg($('#progG'),20); $('#gstatus').textContent='生成中…'
  const r=await fetch('/api/jd/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({need:$('#need').value,lang:'zh'})})
  const d=await r.json(); setProg($('#progG'),85)
  tw($('#genout'), d.jd||'')
  setTimeout(()=>{setProg($('#progG'),100); pulse($('#progG'),false); $('#gstatus').textContent='完成'},280)
}

$('#btnParse').onclick=async()=>{
  pulse($('#progP'),true); setProg($('#progP'),15); $('#pstatus').textContent='解析中…'
  let jdText=$('#jdtext').value
  const f=$('#jdfile').files[0]; if(!jdText && f){
    const fd=new FormData(); fd.append('file', f)
    const r0=await fetch('/api/jd/parse',{method:'POST',body:fd}); const d0=await r0.json(); jdText=d0.jd_summary||''
  }
  if(!jdText){ $('#jdout').textContent='请上传或粘贴 JD'; setProg($('#progP'),100); pulse($('#progP'),false); $('#pstatus').textContent='就绪'; return }
  const fd2=new FormData(); fd2.append('text', jdText)
  const r=await fetch('/api/jd/parse',{method:'POST',body:fd2}); const d=await r.json(); setProg($('#progP'),85)
  tw($('#jdout'), d.jd_summary||'')
  setTimeout(()=>{setProg($('#progP'),100); pulse($('#progP'),false); $('#pstatus').textContent='完成'},260)
}

$('#btnCopy').onclick=()=>{
  const s=($('#jdout').textContent||'').trim(); if(!s){ alert('没有可复制的内容'); return }
  navigator.clipboard.writeText(s).then(()=>{ $('#pstatus').textContent='已复制' })
}
</script>
</body>
</html>
