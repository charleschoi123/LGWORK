<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LGWORK • Admin</title>
<style>
  :root{--pri:#0a66c2;--bg:#f3f2ef;--fg:#091e42;--muted:#5e6c84;--card:#fff;--border:#e0e0e0}
  body{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin:12px 0}
  .btn{background:var(--pri);color:#fff;border:0;border-radius:10px;padding:10px 16px;cursor:pointer}
  input,select{background:#fff;border:1px solid var(--border);border-radius:10px;padding:8px}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h2>职位抓取</h2>
  <div class="card">
    <button class="btn" id="btnFetch">一键抓取（Greenhouse + Lever）</button>
    <div class="muted" id="hint" style="margin-top:6px">若未上传 <code>data/seed_sources.json</code> 或为空，系统会自动使用内置种子列表。</div>
    <div style="margin-top:8px">最近更新：<span id="last">—</span>｜总职位：<b id="count">0</b></div>
  </div>

  <div class="card">
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="q" placeholder="关键词"/>
      <input id="loc" placeholder="地点"/>
      <select id="remote"><option value="">远程不限</option><option value="true">只看远程</option><option value="false">排除远程</option></select>
      <select id="zero"><option value="">零经验不限</option><option value="true">只看零经验友好</option><option value="false">排除零经验友好</option></select>
      <button class="btn" id="btn">筛选</button>
    </div>
    <div id="list" style="margin-top:10px"></div>
  </div>
</div>
<script>
const $=s=>document.querySelector(s)
$('#btnFetch').onclick=async()=>{const r=await fetch('/api/jobs/refresh',{method:'POST'});const d=await r.json();$('#count').textContent=d.count;$('#last').textContent=new Date().toLocaleString();load()}
$('#btn').onclick=load
async function load(){
  const p=new URLSearchParams({q:$('#q').value,location:$('#loc').value,remote:$('#remote').value,zero_exp:$('#zero').value,limit:200})
  const r=await fetch('/api/jobs/list?'+p.toString()); const d=await r.json()
  $('#count').textContent=d.count
  $('#list').innerHTML=(d.items||[]).map(x=>`<div style='border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0;background:#fff'>
    <div><b>${esc(x.title)}</b> · ${esc(x.company)} <span class='muted'>${esc(x.location||'')}</span> ${x.remote?'· Remote':''}</div>
    <div class='muted' style='margin-top:4px;font-size:13px'>${esc((x.description||'').slice(0,200))}…</div>
    <div style='margin-top:6px'><a href='${x.jd_url}' target='_blank'>申请链接 ↗</a></div>
  </div>`).join('')
}
function esc(s){return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;')}
load()
</script>
</body>
</html>
